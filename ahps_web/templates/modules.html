{#
# AHPS Web - web server for managing an AtHomePowerlineServer instance
# Copyright (C) 2014, 2015  Dave Hocker (email: AtHomeX10@gmail.com)
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 3 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the LICENSE file for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program (the LICENSE file).  If not, see <http://www.gnu.org/licenses/>.
#}

{% extends "layout.html" %}

{% block head %}
    {# The jQuery UI dialog for confirming module removal #}
    <div id="dialog" title="Confirmation">
        <p id="dialog-text">Remove the selected module?</p>
    </div>
    <script type="text/javascript">

    </script>
{% endblock %}

{% block body %}
    <h2>Modules for room: {{ room.name }}</h2>
    <input type="hidden" id="roomid" value="{{ room.roomid }}">
    <div id="module-form-{= module.moduleid =}" ng-repeat="module in room_modules">
        <div class="{= module.module_type =}-module">
            <input type="hidden" name="moduleid" value="{= module.moduleid =}">
            {# <input type="hidden" name="module_type" value="{= module.module_type =}"> #}
            <div id="module-name-{= module.moduleid =}" class="name">
                {% include 'module_types.html' %}
                <br/>
                <input type="text" id="module-name-text{= module.moduleid =}" class="module-name"
                       name="module-name" value="{= module.name =}"
                       onchange="track_change()"/>
            </div>
            <div class="hdc">
                <div ng-show="module_type == 'house'">
                    <span class="hdc-text">{= module.house_code =}</span>
                    {% include 'house_codes.html' %}
                    <input type="hidden" id="device_code" name="device_code" value="{= module.device_code =}"/>
                    <input type="hidden" id="dim_amount" name="dim_amount" value="{= module.dim_amount =}"/>
                </div>
                <div ng-show="module_type != 'house'">
                    {# appliance or lamp #}
                    <span class="hdc-text">{= module.house_code =}{= module.device_code =}</span>
                    {% include 'house_codes.html' %}
                    {% include 'device_codes.html' %}
                    <span ng-show="module.type == 'lamp'">
                        <span class="hdc-text">Dim:</span>
                        <input type="text" id="dim_amount" name="dim_amount" class="input-number"
                                 value="{= module.dim_amount =}"
                                 onchange="track_change()"/>
                    </span>
                    <span ng-show="module.type == 'appliance'">
                        <input type="hidden" id="dim_amount" name="dim_amount" value="{= module.dim_amount =}"/>
                        <br/>
                    </span>
                </div>
            </div>
            {# This is used to send the button that was clicked #}
            <input id="submit-button-{= module.moduleid =}" type="hidden" name="button" value=""/>
            {# These buttons are used to capture user clicks. The underlying Javascript
            will set the id=submit-button value to indicate the button that was clicked. #}
            <button onclick="submitForm('save', {= module.moduleid =})" class="edit-button" name="save-button"
                type="button" value="save">Save Module</button>
            <button ng-show="module_type != 'house'" onclick="submitForm('editprograms', {= module.moduleid =})" class="edit-button" name="edit-button"
                    type="button" value="editprograms">Programs</button>
            <br/>
            <button onclick="submitForm('on', {= module.moduleid =})" class="edit-button" name="on-button" type="button" value="on">On</button>
            <button onclick="submitForm('off', {= module.moduleid =})" class="edit-button" name="off-button" type="button" value="off">Off</button>
            <br/>
            <button onclick="showMoveDialog({= module.moduleid =})" class="edit-button" name="move-button" type="button" value="move">Move Module</button>
            <button onclick="showRemoveDialog({= module.moduleid =})" class="edit-button" name="remove-button" type="button" value="remove">Remove Module</button>
        </div>
    </div>

    <div class="clear"></div>

    {# Buttons for adding various module types #}
    <form action="add_module" method="post">
        <button class="edit-button" name=add-appliance type="submit" value="{{ room.roomid }}">Add Appliance</button>
        <button class="edit-button" name=add-lamp type="submit" value="{{ room.roomid }}">Add Lamp</button>
    </form>

    {# The jQuery UI dialog for moving a module to another room #}
    <div id="move-module-dialog" title="Move Module">
        <form id="move-module-form" action="move_module" method="post">
            <input id="module-to-move" type="hidden" name="moduleid" value="">
            <label>New room</label>
            <select name="new_room" id="new_room" class="input-select">
            {% for r in rooms -%}
                <option value="{{ r.roomid }}">{{ r.name }}</option>
            {%- endfor %}
            </select>
        </form>
    </div>

{% endblock %}

{# AngularJS script files #}
{% block angularjs %}
    <script src="{{ url_for('static', filename='js/app.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/modules.js') }}" type="text/javascript"></script>
{% endblock %}
