{% extends "layout.html" %}

{% block head %}
    {# The jQuery UI dialog for confirming room removal #}
    <div id="dialog" title="Confirmation">
        <p id="dialog-text">Remove the selected room?</p>
    </div>
    <script type="text/javascript">
        /* Initialize the confirmation dialog */
        $(document).ready(function() {
            $("#dialog").dialog(
            {
                autoOpen: false,
                modal: true,
                closeOnEscape: false,
                buttons: {
                    "Remove": function(event) {
                        $("#dialog").dialog( "close" );
                        $("#room-form-" + $(this).data("roomid")).submit();
                        },
                    "Cancel": function(event) {
                        $("#dialog").dialog( "close" );
                        }
                }
            });

        });

        /* Show confirmation dialog for removing a room */
        function showDialog(roomid){
            /* Set the value of the hidden button tag to reflect this is a remove */
            $("#submit-button-" + roomid).val("remove");
            /* Set the dialog text with the room name */
            $("#dialog-text").text("Remove room: " + $("#room-name-" + roomid).text() + "?");
            /* Spring the dialog for the given room */
            $("#dialog")
                .data("roomid", roomid)
                .dialog("open");
        };

        /* Show modules for a room */
        function showModules(roomid){
            $("#submit-button-" + roomid).val("showmodules");
            $("#room-form-" + roomid).submit();
        };

    </script>
{% endblock %}

{% block body %}
    <h2>Home</h2>
    <p>This is the home page for the AHPS Web server.</p>

    {% if session.logged_in %}
        <h2>Rooms</h2>
            {% for room in rooms %}
                <div class="room">
                    <form id="room-form-{{ room.roomid }}" action="" method="post">
                        <input type="hidden" name="roomid" value="{{ room.roomid }}"/>
                        <div id="room-name-{{ room.roomid }}"  class="name">{{ room.name }}</div>
                        <div class="description">{{ room.description }}</div>
                        {# This is used to send the button that was clicked #}
                        <input id="submit-button-{{ room.roomid }}" type="hidden" name="button" value=""/>
                        {# These buttons are used to capture user clicks. The underlying Javascript
                        will set the id=submit-button value to indicate the button that was clicked. #}
                        <button onclick="showModules({{ room.roomid }})"  class="edit-button" name="show-button" type="button"
                                value="showmodules">Modules</button>
                        <button onclick="showDialog({{ room.roomid }})" class="edit-button" name="remove-button" type="button"
                                value="remove">Remove Room</button>
                    </form>
{#
                    <form id="remove" action="" method="post">
                        <input type="hidden" name="roomid" value="{{ room.roomid }}"/>
                        <input id="submit-button" type="hidden" name="button" value="remove"/>
                        <button onclick="showDialog()" class="edit-button" name="remove-button" type="button"
                                value="remove">Remove Room</button>
                    </form>
#}
                </div>
            {% endfor %}

            <div class="clear"></div>
            <form action="" method="post">
                <button class="edit-button" name=button type="submit" value="addroom">Add a Room</button>
            </form>
    {% else %}
        <p><b>Login to view the list of rooms.</b></p>
    {% endif %}
{% endblock %}